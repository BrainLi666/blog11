{% extends 'admin/base.html' %}

{% block title %}{{ title }} - 博客管理{% endblock %}

{% block extra_css %}
    <style>
        .editor-container {
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            min-height: 400px;
        }
        .form-focus:focus {
            border-color: #4F46E5 !important;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        .label-required::after {
            content: " *";
            color: #ef4444;
        }
    </style>
{% endblock %}

{% block extra_js %}
    <!-- TinyMCE 富文本编辑器 -->
    <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
    <script>
        tinymce.init({
            selector: '#content',
            height: 400,
            plugins: [
                'advlist autolink lists link image charmap print preview anchor',
                'searchreplace visualblocks code fullscreen',
                'insertdatetime media table paste code help wordcount'
            ],
            toolbar: 'undo redo | formatselect | bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help',
            content_css: 'default',
            setup: function (editor) {
                // 编辑器内容变化时同步到textarea
                editor.on('change', function () {
                    editor.save();
                });
            }
        });
    </script>
{% endblock %}

{% block content %}
    <div class="bg-white rounded-xl shadow-sm p-6">
        <div class="flex items-center justify-between mb-6">
            <div>
                <h1 class="text-2xl font-bold text-gray-900">{{ title }}</h1>
                <p class="text-gray-500 mt-1">创建或编辑博客文章</p>
            </div>
            {% if post %}
                <a href="{{ url_for('post_detail', slug=post.slug) }}" target="_blank" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-custom flex items-center gap-2">
                    <i class="fa fa-eye"></i>
                    预览
                </a>
            {% endif %}
        </div>

        <form method="POST" class="space-y-6">
            {{ form.hidden_tag() }}
            
            <!-- 标题 -->
            <div>
                <label for="title" class="block text-sm font-medium text-gray-700 mb-1 label-required">标题</label>
                {{ form.title(class="w-full px-4 py-2 border border-gray-300 rounded-lg form-focus transition-custom", placeholder="请输入文章标题") }}
            </div>
            
            <!-- 分类 -->
            <div>
                <label for="category" class="block text-sm font-medium text-gray-700 mb-1">分类</label>
                {{ form.category(class="w-full px-4 py-2 border border-gray-300 rounded-lg form-focus transition-custom", placeholder="请输入文章分类") }}
            </div>
            
            <!-- 标签 -->
            <div>
                <label for="tags" class="block text-sm font-medium text-gray-700 mb-1">标签</label>
                {{ form.tags(class="w-full px-4 py-2 border border-gray-300 rounded-lg form-focus transition-custom", placeholder="请输入文章标签，用逗号分隔") }}
                <p class="text-xs text-gray-500 mt-1">例如：技术, 前端, Python</p>
            </div>
            
            <!-- 内容 -->
            <div>
                <label for="content" class="block text-sm font-medium text-gray-700 mb-1 label-required">内容</label>
                {{ form.content(class="w-full form-focus", id="content") }}
            </div>
            
            <!-- 操作按钮 -->
            <div class="flex justify-end gap-4 pt-4 border-t border-gray-200">
                <a href="{{ url_for('admin.dashboard') }}" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-custom">
                    取消
                </a>
                <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-custom font-medium">
                    保存
                </button>
            </div>
        </form>
    </div>
{% endblock %}